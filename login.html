<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acesso ao Painel de Gestão</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center h-screen">

    <div class="w-full max-w-md">
        
        <!-- Formulário de Login -->
        <div id="login-form" class="bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Aceder ao Painel</h2>
            <div id="login-error" class="hidden bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded relative mb-4" role="alert"></div>
            <form>
                <div class="mb-4">
                    <label for="login-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="login-email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div class="mb-6">
                    <label for="login-password" class="block text-sm font-medium text-gray-700">Senha</label>
                    <input type="password" id="login-password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <button type="button" id="login-button" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Entrar</button>
            </form>
            <div class="mt-4 text-center text-sm">
                <a href="#" id="show-register" class="font-medium text-indigo-600 hover:text-indigo-500">Criar uma conta</a> |
                <a href="#" id="show-reset" class="font-medium text-indigo-600 hover:text-indigo-500">Esqueceu a senha?</a>
            </div>
        </div>

        <!-- Formulário de Cadastro -->
        <div id="register-form" class="hidden bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Criar Conta</h2>
            <div id="register-message" class="hidden p-4 mb-4 text-sm rounded-lg" role="alert"></div>
             <form>
                <div class="mb-4">
                    <label for="register-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="register-email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <div class="mb-6">
                    <label for="register-password" class="block text-sm font-medium text-gray-700">Senha (mínimo 6 caracteres)</label>
                    <input type="password" id="register-password" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <button type="button" id="register-button" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Cadastrar</button>
            </form>
            <div class="mt-4 text-center text-sm">
                <a href="#" id="back-to-login-1" class="font-medium text-indigo-600 hover:text-indigo-500">Já tenho uma conta</a>
            </div>
        </div>

        <!-- Formulário de Recuperação de Senha -->
        <div id="reset-form" class="hidden bg-white p-8 rounded-lg shadow-md">
            <h2 class="text-2xl font-bold mb-6 text-center text-gray-800">Recuperar Senha</h2>
            <div id="reset-message" class="hidden p-4 mb-4 text-sm rounded-lg" role="alert"></div>
            <p class="text-center text-gray-600 mb-4 text-sm">Digite seu email e enviaremos um link para redefinir sua senha.</p>
            <form>
                <div class="mb-6">
                    <label for="reset-email" class="block text-sm font-medium text-gray-700">Email</label>
                    <input type="email" id="reset-email" required class="mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-500 focus:ring-indigo-500">
                </div>
                <button type="button" id="reset-button" class="w-full bg-indigo-600 text-white font-semibold py-2 px-4 rounded-lg hover:bg-indigo-700 transition duration-300">Enviar Link de Recuperação</button>
            </form>
            <div class="mt-4 text-center text-sm">
                <a href="#" id="back-to-login-2" class="font-medium text-indigo-600 hover:text-indigo-500">Voltar para o Login</a>
            </div>
        </div>
    </div>
    
    <script src="firebase-config.js"></script>
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-app.js";
        import { 
            getAuth, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            sendEmailVerification,
            sendPasswordResetEmail,
            onAuthStateChanged
        } from "https://www.gstatic.com/firebasejs/9.15.0/firebase-auth.js";

        // Inicializa Firebase
        const app = initializeApp(window.firebaseConfig);
        const auth = getAuth(app);

        // Elementos dos formulários
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const resetForm = document.getElementById('reset-form');

        // Botões de navegação
        document.getElementById('show-register').addEventListener('click', () => {
            loginForm.classList.add('hidden');
            registerForm.classList.remove('hidden');
        });
        document.getElementById('show-reset').addEventListener('click', () => {
            loginForm.classList.add('hidden');
            resetForm.classList.remove('hidden');
        });
        document.getElementById('back-to-login-1').addEventListener('click', () => {
            registerForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });
        document.getElementById('back-to-login-2').addEventListener('click', () => {
            resetForm.classList.add('hidden');
            loginForm.classList.remove('hidden');
        });

        // Lógica de Autenticação
        const loginBtn = document.getElementById('login-button');
        const registerBtn = document.getElementById('register-button');
        const resetBtn = document.getElementById('reset-button');

        const loginError = document.getElementById('login-error');
        const registerMsg = document.getElementById('register-message');
        const resetMsg = document.getElementById('reset-message');

        // Checa se o usuário já está logado e redireciona
        onAuthStateChanged(auth, user => {
            if (user && user.emailVerified) {
                window.location.href = 'admin.html';
            }
        });


        // Login
        loginBtn.addEventListener('click', () => {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-password').value;
            loginError.classList.add('hidden');

            signInWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    // Logado com sucesso, será redirecionado pelo onAuthStateChanged
                })
                .catch((error) => {
                    loginError.textContent = "Email ou senha inválidos.";
                    loginError.classList.remove('hidden');
                });
        });

        // Cadastro
        registerBtn.addEventListener('click', () => {
            const email = document.getElementById('register-email').value;
            const pass = document.getElementById('register-password').value;
            registerMsg.classList.add('hidden');
            
            createUserWithEmailAndPassword(auth, email, pass)
                .then((userCredential) => {
                    const user = userCredential.user;
                    sendEmailVerification(user)
                        .then(() => {
                            registerMsg.className = 'p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50';
                            registerMsg.textContent = 'Conta criada! Um email de verificação foi enviado para ' + user.email + '. Por favor, verifique sua caixa de entrada e spam.';
                            registerMsg.classList.remove('hidden');
                        });
                })
                .catch((error) => {
                    registerMsg.className = 'p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50';
                    if (error.code === 'auth/email-already-in-use') {
                        registerMsg.textContent = 'Este email já está em uso.';
                    } else if (error.code === 'auth/weak-password') {
                        registerMsg.textContent = 'A senha é muito fraca. Use pelo menos 6 caracteres.';
                    } else {
                        registerMsg.textContent = 'Ocorreu um erro ao criar a conta.';
                    }
                    registerMsg.classList.remove('hidden');
                });
        });
        
        // Recuperar Senha
        resetBtn.addEventListener('click', () => {
             const email = document.getElementById('reset-email').value;
             resetMsg.classList.add('hidden');
             
             sendPasswordResetEmail(auth, email)
                .then(() => {
                    resetMsg.className = 'p-4 mb-4 text-sm text-green-800 rounded-lg bg-green-50';
                    resetMsg.textContent = 'Link de recuperação enviado para ' + email + '. Verifique sua caixa de entrada.';
                    resetMsg.classList.remove('hidden');
                })
                .catch((error) => {
                     resetMsg.className = 'p-4 mb-4 text-sm text-red-800 rounded-lg bg-red-50';
                     resetMsg.textContent = 'Erro ao enviar email. Verifique se o endereço está correto.';
                     resetMsg.classList.remove('hidden');
                });
        });

    </script>

</body>
</html>
