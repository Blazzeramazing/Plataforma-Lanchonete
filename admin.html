<!DOCTYPE html>
<html lang="pt-pt">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Painel de Administração</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Poppins', sans-serif; }
        .modal-backdrop { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.5); justify-content: center; align-items: center; z-index: 50; }
        .modal-content { background: white; padding: 2rem; border-radius: 1rem; max-width: 500px; width: 90%; }
        details > summary { list-style: none; }
        details > summary::-webkit-details-marker { display: none; }
    </style>
</head>
<body class="bg-gray-200">

    <div class="container mx-auto p-4 md:p-8 space-y-8">
        <h1 class="text-3xl font-bold text-gray-800">Painel de Administração</h1>
        
        <!-- Configurações Gerais -->
        <details class="bg-white p-6 rounded-xl shadow-md" open>
            <summary class="text-2xl font-semibold text-gray-700 cursor-pointer">Configurações Gerais da Página</summary>
            <div class="mt-6 space-y-6" id="config-form">
                <!-- Informações -->
                <fieldset class="border p-4 rounded-lg">
                    <legend class="px-2 font-semibold">Informações e Contato</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-2">
                        <div>
                            <label for="whatsappNumber" class="block text-sm font-medium text-gray-600">Nº WhatsApp (com código do país)</label>
                            <input type="text" id="whatsappNumber" placeholder="351912345678" class="mt-1 input-field">
                        </div>
                        <div>
                            <label for="instagramLink" class="block text-sm font-medium text-gray-600">Link Instagram</label>
                            <input type="url" id="instagramLink" class="mt-1 input-field">
                        </div>
                        <div>
                            <label for="facebookLink" class="block text-sm font-medium text-gray-600">Link Facebook</label>
                            <input type="url" id="facebookLink" class="mt-1 input-field">
                        </div>
                    </div>
                </fieldset>
                
                <!-- Aparência -->
                <fieldset class="border p-4 rounded-lg">
                    <legend class="px-2 font-semibold">Aparência do Cabeçalho</legend>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-6 mt-2">
                        <div>
                            <label for="headerTitle" class="block text-sm font-medium text-gray-600">Título Principal</label>
                            <input type="text" id="headerTitle" class="mt-1 input-field">
                        </div>
                        <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label for="headerTitleColor" class="block text-sm font-medium text-gray-600">Cor</label>
                                <input type="color" id="headerTitleColor" class="mt-1 w-full h-10 rounded-md">
                            </div>
                            <div>
                                <label for="headerTitleSize" class="block text-sm font-medium text-gray-600">Tam. Fonte (px)</label>
                                <input type="number" id="headerTitleSize" class="mt-1 input-field">
                            </div>
                        </div>
                        <div>
                            <label for="headerSubtitle" class="block text-sm font-medium text-gray-600">Subtítulo</label>
                            <input type="text" id="headerSubtitle" class="mt-1 input-field">
                        </div>
                         <div class="grid grid-cols-2 gap-2">
                            <div>
                                <label for="headerSubtitleColor" class="block text-sm font-medium text-gray-600">Cor</label>
                                <input type="color" id="headerSubtitleColor" class="mt-1 w-full h-10 rounded-md">
                            </div>
                            <div>
                                <label for="headerSubtitleSize" class="block text-sm font-medium text-gray-600">Tam. Fonte (px)</label>
                                <input type="number" id="headerSubtitleSize" class="mt-1 input-field">
                            </div>
                        </div>
                    </div>
                </fieldset>

                <!-- Imagens -->
                <fieldset class="border p-4 rounded-lg">
                    <legend class="px-2 font-semibold">Imagens</legend>
                    <!-- Carrossel -->
                    <div>
                        <label class="block font-medium text-gray-600">URLs das Imagens do Carrossel</label>
                        <div id="carousel-list" class="space-y-2 mt-2"></div>
                        <div class="flex mt-2 space-x-2">
                            <input type="url" id="carousel-url-input" placeholder="https://..." class="input-field flex-grow">
                            <button type="button" id="add-carousel-btn" class="btn-primary">Adicionar</button>
                        </div>
                    </div>
                    <!-- Fixas -->
                    <div class="mt-4">
                        <label class="block font-medium text-gray-600">URLs das Imagens Fixas</label>
                        <div id="fixed-list" class="space-y-2 mt-2"></div>
                        <div class="flex mt-2 space-x-2">
                            <input type="url" id="fixed-url-input" placeholder="https://..." class="input-field flex-grow">
                            <button type="button" id="add-fixed-btn" class="btn-primary">Adicionar</button>
                        </div>
                    </div>
                </fieldset>

                 <!-- Localização -->
                <fieldset class="border p-4 rounded-lg">
                    <legend class="px-2 font-semibold">Localização</legend>
                    <div>
                        <label for="mapsEmbed" class="block text-sm font-medium text-gray-600">Código de Incorporação do Google Maps</label>
                        <textarea id="mapsEmbed" rows="4" class="mt-1 input-field" placeholder='<iframe src="..."></iframe>'></textarea>
                    </div>
                </fieldset>

                <button id="save-config-btn" class="w-full bg-green-600 text-white py-2 px-4 rounded-md hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500 transition-colors">Salvar Configurações Gerais</button>
            </div>
        </details>

        <!-- Gestão do Cardápio -->
        <details class="bg-white p-6 rounded-xl shadow-md" open>
            <summary class="text-2xl font-semibold text-gray-700 cursor-pointer">Gestão do Cardápio</summary>
            <!-- Formulário de Adição/Edição -->
            <div class="mt-4">
                <h3 id="form-title" class="text-xl font-semibold mb-4 text-gray-700">Adicionar Novo Item</h3>
                <form id="item-form" class="space-y-4">
                    <input type="hidden" id="item-id">
                    <div>
                        <label for="name" class="block text-sm font-medium text-gray-600">Nome do Item</label>
                        <input type="text" id="name" required class="mt-1 input-field">
                    </div>
                     <div>
                        <label for="imageUrl" class="block text-sm font-medium text-gray-600">URL da Imagem do Item (Opcional)</label>
                        <input type="url" id="imageUrl" class="mt-1 input-field">
                    </div>
                    <div>
                        <label for="description" class="block text-sm font-medium text-gray-600">Descrição</label>
                        <textarea id="description" rows="3" required class="mt-1 input-field"></textarea>
                    </div>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                        <div>
                            <label for="price" class="block text-sm font-medium text-gray-600">Preço (€)</label>
                            <input type="number" id="price" step="0.01" min="0" required class="mt-1 input-field">
                        </div>
                        <div>
                            <label for="category" class="block text-sm font-medium text-gray-600">Categoria</label>
                            <input type="text" id="category" placeholder="Ex: Sanduíches" required class="mt-1 input-field">
                        </div>
                    </div>
                    <div class="flex space-x-4">
                        <button type="submit" id="submit-button" class="w-full bg-yellow-600 text-white py-2 px-4 rounded-md hover:bg-yellow-700">Salvar Item</button>
                        <button type="button" id="cancel-edit-button" class="w-full bg-gray-500 text-white py-2 px-4 rounded-md hover:bg-gray-600 hidden">Cancelar Edição</button>
                    </div>
                </form>
            </div>

            <!-- Lista de Itens do Cardápio -->
            <div class="mt-8">
                <h3 class="text-xl font-semibold mb-4 text-gray-700">Itens Atuais do Cardápio</h3>
                <div id="admin-menu-list" class="space-y-4"></div>
            </div>
        </details>
    </div>

    <!-- Modal de Confirmação -->
    <div id="delete-confirm-modal" class="modal-backdrop">
        <div class="modal-content">
            <h3 class="text-xl font-bold mb-4">Confirmar Remoção</h3>
            <p class="text-gray-600 mb-6">Tem a certeza?</p>
            <div class="flex justify-end space-x-4">
                <button id="cancel-delete" class="px-4 py-2 bg-gray-300 rounded-md">Cancelar</button>
                <button id="confirm-delete" class="px-4 py-2 bg-red-600 text-white rounded-md">Remover</button>
            </div>
        </div>
    </div>

    <!-- Firebase -->
    <script type="module">
        // --- Configuração do Firebase ---
        // Suas credenciais do Firebase preenchidas automaticamente aqui.
        const firebaseConfig = {
          apiKey: "AIzaSyC7J_J7JCagM65E5qkl1z-Kn2V360ldmdg",
          authDomain: "minhas-credenciais-firebase.firebaseapp.com",
          projectId: "minhas-credenciais-firebase",
          storageBucket: "minhas-credenciais-firebase.firebasestorage.app",
          messagingSenderId: "90146495031",
          appId: "1:90146495031:web:04bdab47de65f7444cbdb2"
        };
        const appId = firebaseConfig.projectId; // Usar o projectId como ID do app
        
        // Adicionar estilos comuns para inputs
        const style = document.createElement('style');
        style.textContent = `
            .input-field { width: 100%; border-radius: 0.375rem; border: 1px solid #D1D5DB; padding: 0.5rem 0.75rem; }
            .btn-primary { background-color: #4F46E5; color: white; padding: 0.5rem 1rem; border-radius: 0.375rem; }
            .btn-danger { background-color: #DC2626; color: white; padding: 0.25rem 0.5rem; border-radius: 0.375rem; font-size: 0.75rem; }
        `;
        document.head.appendChild(style);

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, onSnapshot, doc, addDoc, setDoc, deleteDoc, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- Refs do Firestore ---
        const configDocRef = doc(db, `/artifacts/${appId}/public/data/config`, 'site_settings');
        const menuCollection = collection(db, `/artifacts/${appId}/public/data/menu`);

        let menuSnapshotDocs = []; // Cache para edição

        // --- Autenticação ---
        onAuthStateChanged(auth, user => {
            if (user) {
                loadConfig();
                loadMenuItems();
            } else {
                signInAnonymously(auth);
            }
        });
        
        // --- Lógica de Configurações Gerais ---
        function loadConfig() {
            onSnapshot(configDocRef, (doc) => {
                if (!doc.exists()) return;
                const config = doc.data();
                Object.keys(config).forEach(key => {
                    const el = document.getElementById(key);
                    if (el) el.value = config[key];
                });
                renderImageList('carousel', config.carouselImages || []);
                renderImageList('fixed', config.fixedImages || []);
            });
        }
        
        document.getElementById('save-config-btn').addEventListener('click', async () => {
            const configData = {
                whatsappNumber: document.getElementById('whatsappNumber').value,
                instagramLink: document.getElementById('instagramLink').value,
                facebookLink: document.getElementById('facebookLink').value,
                headerTitle: document.getElementById('headerTitle').value,
                headerTitleColor: document.getElementById('headerTitleColor').value,
                headerTitleSize: document.getElementById('headerTitleSize').value,
                headerSubtitle: document.getElementById('headerSubtitle').value,
                headerSubtitleColor: document.getElementById('headerSubtitleColor').value,
                headerSubtitleSize: document.getElementById('headerSubtitleSize').value,
                mapsEmbed: document.getElementById('mapsEmbed').value,
                carouselImages: getImageListFromDOM('carousel'),
                fixedImages: getImageListFromDOM('fixed'),
            };
            await setDoc(configDocRef, configData, { merge: true });
            alert('Configurações salvas!');
        });
        
        // Lógica para listas de imagens
        function setupImageManager(type) {
            document.getElementById(`add-${type}-btn`).addEventListener('click', () => {
                const input = document.getElementById(`${type}-url-input`);
                if (input.value) {
                    renderImageList(type, [...getImageListFromDOM(type), input.value]);
                    input.value = '';
                }
            });
            document.getElementById(`${type}-list`).addEventListener('click', e => {
                 if (e.target.classList.contains('remove-img-btn')) {
                    e.target.parentElement.remove();
                }
            });
        }
        function renderImageList(type, urls) {
            const container = document.getElementById(`${type}-list`);
            container.innerHTML = urls.map(url => `
                <div class="flex items-center justify-between bg-gray-100 p-2 rounded">
                    <span class="text-sm truncate mr-2">${url}</span>
                    <button type="button" class="remove-img-btn btn-danger">X</button>
                </div>
            `).join('');
        }
        function getImageListFromDOM(type) {
            const list = document.getElementById(`${type}-list`);
            return Array.from(list.querySelectorAll('span')).map(span => span.textContent);
        }
        setupImageManager('carousel');
        setupImageManager('fixed');

        // --- Lógica de Gestão do Cardápio ---
        const itemForm = document.getElementById('item-form');
        const formTitle = document.getElementById('form-title');
        const submitButton = document.getElementById('submit-button');
        const cancelEditButton = document.getElementById('cancel-edit-button');
        const adminMenuList = document.getElementById('admin-menu-list');

        function resetItemForm() {
            itemForm.reset();
            document.getElementById('item-id').value = '';
            formTitle.textContent = 'Adicionar Novo Item';
            submitButton.textContent = 'Salvar Item';
            cancelEditButton.classList.add('hidden');
        }

        itemForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const id = document.getElementById('item-id').value;
            const itemData = {
                name: document.getElementById('name').value,
                description: document.getElementById('description').value,
                price: document.getElementById('price').value,
                category: document.getElementById('category').value.trim(),
                imageUrl: document.getElementById('imageUrl').value,
            };

            if (id) {
                await setDoc(doc(db, `/artifacts/${appId}/public/data/menu`, id), itemData);
            } else {
                await addDoc(menuCollection, itemData);
            }
            resetItemForm();
        });

        function loadMenuItems() {
            onSnapshot(query(menuCollection), (snapshot) => {
                menuSnapshotDocs = snapshot.docs;
                adminMenuList.innerHTML = '';
                menuSnapshotDocs.forEach(doc => {
                    const item = doc.data();
                    adminMenuList.innerHTML += `
                        <div class="flex items-center justify-between p-3 bg-gray-100 rounded-lg">
                            <div>
                                <p class="font-bold">${item.name} <span class="text-sm font-normal text-gray-500">(${item.category})</span></p>
                                <p class="text-sm text-gray-600">€${parseFloat(item.price).toFixed(2)}</p>
                            </div>
                            <div class="flex space-x-2">
                                <button data-id="${doc.id}" class="edit-btn bg-blue-500 text-white px-3 py-1 rounded-md text-sm hover:bg-blue-600">Editar</button>
                                <button data-id="${doc.id}" class="delete-btn bg-red-500 text-white px-3 py-1 rounded-md text-sm hover:bg-red-600">Remover</button>
                            </div>
                        </div>`;
                });
            });
        }
        
        cancelEditButton.addEventListener('click', resetItemForm);

        // --- Lógica de Edição e Remoção ---
        const deleteModal = document.getElementById('delete-confirm-modal');
        let itemToDeleteId = null;

        adminMenuList.addEventListener('click', (e) => {
            const id = e.target.dataset.id;
            if (e.target.classList.contains('edit-btn')) {
                const doc = menuSnapshotDocs.find(d => d.id === id);
                if(doc) {
                    const item = doc.data();
                    document.getElementById('item-id').value = id;
                    document.getElementById('name').value = item.name;
                    document.getElementById('description').value = item.description;
                    document.getElementById('price').value = item.price;
                    document.getElementById('category').value = item.category;
                    document.getElementById('imageUrl').value = item.imageUrl || '';
                    
                    formTitle.textContent = 'Editar Item';
                    submitButton.textContent = 'Atualizar Item';
                    cancelEditButton.classList.remove('hidden');
                    itemForm.scrollIntoView({ behavior: 'smooth' });
                }
            } else if (e.target.classList.contains('delete-btn')) {
                itemToDeleteId = id;
                deleteModal.style.display = 'flex';
            }
        });

        document.getElementById('cancel-delete').addEventListener('click', () => deleteModal.style.display = 'none');
        document.getElementById('confirm-delete').addEventListener('click', async () => {
            if(itemToDeleteId) {
                await deleteDoc(doc(db, `/artifacts/${appId}/public/data/menu`, itemToDeleteId));
                deleteModal.style.display = 'none';
            }
        });

    </script>
</body>
</html>

